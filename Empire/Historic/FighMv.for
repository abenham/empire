	SUBROUTINE FIGHMV
C
C THIS SUBROUTINE HANDLES PLAYER"S FIGHTER MOVES
C
	INCLUDE "EMPIRE.INC/NOLIST"
	LOGICAL FATAL
C 
	DO 2100 Y=1,UpperIndex(2)
	LOC=500+Y
	IF (MOVEDFLAG(LOC).NE.0) GOTO 2100
	Z6=UnitLocation(LOC)
	IF (Z6.EQ.0) GOTO 2100
	IF ((MODE.EQ.1).AND.(POSCHK(Z6,"F").EQ.0)) GOTO 2100
	MOVEDFLAG(LOC)=1
	Z3=MIN(RANGE(Y),4)
	IF (Z3.EQ.0) Z3=4

	DO 1900 ITURN=1,Z3
	LOC=500+Y
	Z6=UnitLocation(LOC)
	IF (Z6.EQ.0) GOTO 2100
	AB=ReferenceMap(Z6)
C 
C NOW CHECK TO SEE IF FIGHTER IS IN A CITY, IF IT IS CHANGE THE
C STASIS NUMBER OF THE FIGHTER TO THAT SPECIFIED BY FIPATH(I)
C
	IF (AB.NE."O") GOTO 300		'IF FIGHTER NOT IN CITY
	DO 100 I=1,70
100	IF (CityLocation(I).EQ.Z6) GOTO 200		'FIND CITY AT Z6
200	MYCODE(LOC)=FIPATH(I)			'CHANGE STASIS OF FIGHTER
C 
C CHECK FOR FIGHTERS DESTROYED ALONG WITH CARRIER OR CITY
C
300	IF ((AB.EQ."C").OR.(AB.EQ."F").OR.(AB.EQ."O")) GOTO 400
	CALL LIB$SET_CURSOR(3,1)
	CALL STROUT("Fighter #",0)
	CALL DECPRT(Y)
	CALL STROUT(" destroyed.",1)
	GOTO 1700
400	Z7=Z6
	CALL STASIS(Z6,LOC)
500	IF (RANGE(Y).NE.0) GOTO 600		'CHECK FOR FUEL
	CALL HEAD("F",Y,LOC,Z6,1)
	CALL LIB$SET_CURSOR(3,1)
	CALL STROUT("Ran out of fuel and crashed.",1)
	IF ((AB.NE."C").AND.(MasterMap(Z6).NE."*")) ReferenceMap(Z6)=MasterMap(Z6)
	GOTO 1700

600	MYCOD=MYCODE(LOC)			'GET MY FUNCTION CODE
	IF (MYCOD.EQ.0) GOTO 1100		'NONE, SKIP AHEAD
	IF ((MYCOD.LT.101).OR.(MYCOD.GT.6108)) GOTO 1300
	IF (MYCOD.LE.6000) GOTO 700
	IF (MYCOD.GT.6100) GOTO 800
	GOTO 1300

700	DIR=MOV(Z6,MYCOD)
	Z6=Z6+MoveOffset(DIR+1)		'DESTINATION FUNCTION
	IF ((RANGE(Y).EQ.10).AND.(IDIST(Z6,MYCOD).LE.10)) GOTO 902
	GOTO 900

800	Z6=Z6+MoveOffset(MYCOD-6100+1)		'DIRECTIONAL FUNCTIONS
900	IF (RANGE(Y).EQ.10) GOTO 1000
902	IF (ORDER(Z6).NE.0) GOTO 1000
	AD=ReferenceMap(Z6)				'CHECK NEW LOCATION
	IF ((AD.EQ."C").OR.(AD.EQ."O")) GOTO 1300
	IF ((AD.EQ."+").OR.(AD.EQ.".")) GOTO 1300
	IF (MYCOD.GT.6100) GOTO 1000
	IF ((AD.LT."A").OR.(AD.GT."T")) GOTO 1000
	IF (ORDER(Z6+MoveOffset(DIR+1)).NE.0) GOTO 1000
	AC=ReferenceMap(Z6+MoveOffset(DIR+1))
	IF ((AC.NE."C").AND.(AC.NE."O").AND.(AC.NE."+").AND.(AC.NE."."))
	1 GOTO 1000
	Z6=Z7+MoveOffset(ICORR(DIR+1)+1)
	IF (ORDER(Z6).NE.0) GOTO 950
	IF ((ReferenceMap(Z6).EQ."+").OR.(ReferenceMap(Z6).EQ.".")) GOTO 1300
950	Z6=Z7+MoveOffset(ICORR(DIR-1)+1)
	IF (ORDER(Z6).NE.0) GOTO 1000
	IF ((ReferenceMap(Z6).EQ."+").OR.(ReferenceMap(Z6).EQ.".")) GOTO 1300
1000	Z6=Z7
1100	CALL SECTOR(PlayerMap(1))
	CALL LTR(Z6,ITURN)
1200	CALL MVE("F",MDATE,Y,LOC,1,Z6,Z7,DISAS,Z6-IADJST)
	IF (DISAS.EQ.-2) GOTO 500
C 
C MOVE EVALUATION
C 
1300	AC=ReferenceMap(Z6)
	AO=MasterMap(Z6)
	IF (Z6.EQ.MYCODE(LOC)) MYCODE(LOC)=0	'ARRIVED AT DESTINATION
	IF ((AC.NE."O").AND.(AC.NE."C")) RANGE(Y)=RANGE(Y)-1
	IF (Z7.EQ.Z6) GOTO 2000		'DIDNT GO ANYWHERE, END MOVE
	IF ((AB.NE."C").AND.(MasterMap(Z7).NE."*")) ReferenceMap(Z7)=MasterMap(Z7) 'CHANGE PREV LOC
	IF (AO.EQ."*") GOTO 1400	'CHECK ON CITIES
	IF (AC.EQ."C") GOTO 1500	'LANDING ON A CARRIER
	IF ((AC.NE.".").AND.(AC.NE."+")) GOTO 1800 'ATTACK ANY OTHER UNITS

	ReferenceMap(Z6)="F"			'NORMAL MOVE
	UnitLocation(LOC)=Z6
	GOTO 1900

1400	IF (AC.NE."O") GOTO 1600	' IS IT MY CITY?
1500	CALL LIB$SET_CURSOR(3,1)	'LANDED IN A CITY OR CARRIER
	IF (MYCODE(LOC).EQ.0) CALL STROUT("Landing confirmed.",1)
	MYCODE(LOC)=0			'ZERO MY FUNCTION
	UnitLocation(LOC)=Z6
	RANGE(Y)=20
	GOTO 2000

1600	IF (.NOT.FATAL(3)) GOTO 2200	'ASK ABOUT FLYING OVER ENEMY CITY
	CALL LIB$SET_CURSOR(3,1)
	CALL STROUT("Fighter shot down.",1)
1700	UnitLocation(LOC)=0
	GOTO 2000

C ATTACKING A UNIT
1800	IF ((AC.GE."A").AND.(AC.LE."T")) THEN
		IF (.NOT.FATAL(2)) GOTO 2200
		ENDIF
	H1=1
	OWN1="F"
	OWN2=AC
	H2=30
	CALL FIND(OWN2,Z6,Z8,H2)
	CALL FGHT(Z6,H1,H2,OWN1,OWN2)
	CALL FIND(OWN2,Z6,Z8,H2)
	IF (H1.LE.0) GOTO 1700
	ReferenceMap(Z6)="F"
	UnitLocation(LOC)=Z6
	IF ((OWN2.GE."a").AND.(OWN2.LE."t")) CALL SONAR(Z6)
1900	CALL SENSOR(Z6)			'BOTTOM OF PER TURN LOOP

2000	CALL SENSOR(Z6)			'BOTTOM OF PER UNIT LOOP
2100	CONTINUE
	RETURN
C
C RECOVER FROM FATAL MOVE
C
2200	Z6=Z7				'GO BACK TO OLD LOCATION
	ReferenceMap(Z6)=AB			'RESTORE MAP TO PREVIOUS
	RANGE(Y)=RANGE(Y)+1		'GET YOUR FUEL BACK
	GOTO 1200
	END