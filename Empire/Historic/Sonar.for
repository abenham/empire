C 
	SUBROUTINE SONAR(Z6)
C
C UPDATES COMPUTER"S MAP AROUND LOCATION Z6
C
	INCLUDE "EMPIRE.INC/NOLIST"
C 
	DO 1300 I=1,8
	LOCUS=Z6+MoveOffset(I+1)			'**
	AB=ReferenceMap(LOCUS)
	IF (AB.NE.EMAP(LOCUS)) EMAP(LOCUS)=AB
	IF ((AB.NE."*").AND.(AB.NE."O")) GOTO 400
	DO 100 I1=1,70
100	IF (TargetCity(I1).EQ.LOCUS) GOTO 1300
	DO 200 I1=1,70
200	IF (TargetCity(I1).EQ.0) GOTO 300
300	TargetCity(I1)=LOCUS
400	IF ((AB.LT."A").OR.(AB.GT."T")) GOTO 1300
	IF (AB.NE."A".AND.AB.NE."O") GOTO 1100
C 
C WE MUST NOW FIGURE OUT IF THE ARMY IS A THREAT TO ANY OF THE COMPUTER"S
C CITIES, I.E. IF IT IS ON THE CONTINENT WITH ANY OF THEM. IF SO, PUT
C THE ARMY IN THE Sightings ARRAY. THE FIRST INDEX IS THE CONTINENT, THE
C SECOND IS THE NTH ARMY DISCOVERED ON THAT CONTINENT - 1. THE (N,1)
C ARGUMENT IS THE DATE OF THE LAST ARMY DISCOVERED ON THE
C NTH CONTINENT. THUS WE HAVE A MEANS OF DETERMINING THE AGE OF THE DATA
C 
	ARMDEF=0
	DO 480 Y=1,UpperIndex(9)
	IF (UnitLocation(CArmyStart+Y).EQ.0) GOTO 480
	IF (IDIST(LOCUS,UnitLocation(CArmyStart+Y)).GT.14) GOTO 480
	MOVE=PATH(UnitLocation(CArmyStart+Y),LOCUS,1,OKA,FLAG)
	IF (FLAG.NE.0) ARMDEF=ARMDEF+1
480	CONTINUE
	IF (ARMDEF.GE.7) GOTO 520

	DO 500 K=1,70
	IF ((CityOwner(K).NE.2).OR.(CityProduction(K).EQ.1)) GOTO 500
	IF (FOUND(K)-MDATE-5.LE.0) GOTO 500
	IF (IDIST(CityLocation(K),LOCUS).GT.18) GOTO 500
	MOVE=PATH(CityLocation(K),LOCUS,1,OKA,FLAG)
	IF (FLAG.NE.0) CityProduction(K)=-1
500	CONTINUE
C 
520	IF (AB.EQ."O") GOTO 1300
	DO 600 K=1,10
	IF (Sightings(K,2).EQ.0) GOTO 600
	DO 550 J=2,11
	IF (Sightings(K,J).EQ.LOCUS) GOTO 800
550	CONTINUE
	MOVE=PATH(LOCUS,Sightings(K,2),1,OKA,FLAG)
	J=11
	IF (FLAG.NE.0) GOTO 800
600	CONTINUE

	DO 700 K=1,10
700	IF (Sightings(K,2).EQ.0) GOTO 760

	OLDEST=10000
	DO 750 J=1,10
	IF (Sightings(J,1).LT.OLDEST) THEN
	  OLDEST=Sightings(J,1)
	  K=J
	ENDIF
750	CONTINUE
760	DO 770 J=2,11
770	Sightings(K,J)=0
	GOTO 1000

800	DO 900 J=J,3,-1
900	Sightings(K,J)=Sightings(K,J-1)			'SHIFT EVERYTHING UP THE ARRAY
1000	Sightings(K,1)=MDATE
	Sightings(K,2)=LOCUS
	GOTO 1300
C 
1100	ISHIPT=0
	IF (AB.EQ."D") ISHIPT=1
	IF (AB.EQ."S") ISHIPT=2
	IF (AB.EQ."T") ISHIPT=3
	IF (AB.EQ."R") ISHIPT=4
	IF (AB.EQ."C") ISHIPT=5
	IF (AB.EQ."B") ISHIPT=6
	IF (ISHIPT.EQ.0) GOTO 1300
	DO 1200 IB=1,4
1200	TROOPT(ISHIPT,IB)=TROOPT(ISHIPT,IB+1)
	TROOPT(ISHIPT,5)=LOCUS
1300	CONTINUE
	EMAP(Z6)=ReferenceMap(Z6)
	IF (DebugLevel.EQ.10) CALL SENSOR(Z6)
	RETURN
	END