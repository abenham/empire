	SUBROUTINE EDIT(Z5)
C 
C EDIT MODE COMMAND SUBROUTINE
C TEST ROUTINES FOR PATH
C 
	INCLUDE "EMPIRE.INC/NOLIST"
C 
	Z6=Z5
	WHTFLG=0
	MOVFLG=0
	OLDJ=JECTOR
	CALL SECTOR(PlayerMap(1))
100	LINE=KLINE(KI,JECTOR)
	IADJST=LINE+KI-300
	IF (Z6.EQ.0) Z6=IADJST+1240
	DIR=1
200	IF (GIGI) CALL REGIS_ON
	CALL CURSOR(Z6-IADJST)
	IF (GIGI) CALL CENTER_CURSOR
	E=GETCHX()
	IF (GIGI) CALL REGIS_OFF
	Z7=Z6
	DO 300 I=1,8
300	IF (E.EQ.COMM(I)) Z6=Z6+MoveOffset(I+1)	'IF CURSOR MOVE, CHANGE LOCATION
	IF ((SCRCHK(Z6).EQ.1).AND.(ORDER(Z6).EQ.0)) GOTO 400
	Z6=Z7					'IF NOT ON SCREEN, GET BACK
	GOTO 4500

400	IF (Z6.EQ.Z7) GOTO 500
	GOTO 200
500	DO 600 I=10,30
	J=I
600	IF (E.EQ.COMM(I)) GOTO 700
	GOTO 4500
C			 L, B, F, T, G, V, J, U,-1,-1		PRIV CMDS
700	IF (PASS) GOTO (800,900,1000,1100,1200,1400,1500,1600,1700,1800) J-9
C		O, P, R, I, M, K, N, S, ?, Y, H			NORMAL CMDS
	GOTO (1300,1900,4300,2100,2500,2700,2900,3100,3200,4200,4400) J-19
	GOTO 4500

800	ISEC=-1					'N - DISPLAY ENEMY SECTOR
	CALL SECTOR(EMAP(1))
	GOTO 200

900	BEG=Z6					'B - SET BEG
	ICityLocation="B"
	TYPE 999,ICityLocation
999	FORMAT("+",A1,$)
	GOTO 200

1000	END=Z6					'F - SET END
	ICityLocation="E"
	TYPE 999,ICityLocation
	GOTO 200

1100	FLAG=1000				'T - SINGLE STEP & TRACE PATH
	CALL PATH(BEG,END,DIR,OKC,FLAG)
	GOTO 200

1200	FLAG=1001				'G - SHOW PATH CHOSEN
	CALL PATH(BEG,END,DIR,OKC,FLAG)
	GOTO 200

1300	CONTINUE				'O - RETURN TO CALLER
	JECTOR=OLDJ				'RESTORE SECTOR NUMBER
	LINE=KLINE(KI,JECTOR)
	IADJST=LINE+KI-300
	CALL SECTOR(PlayerMap(1))			' REFRESH OUR MAP
	RETURN

1400	DIR=-DIR				'V - REVERSE DIRECTION
	GOTO 200

1500	H2=30					'J - DISPLAY CODE VALUES FOR
	OWN2=ReferenceMap(Z6)				'    ENEMY UNITS
	IF (OWN2.LT."a" .OR. OWN2.GT."9") GOTO 4500
	CALL FIND(OWN2,Z6,Z8,H2)
	CALL LIB$SET_CURSOR(1,50)
	CALL STROUT(" Code:",2)
	TYPE 998,UnitAction(Z8-1500),UnitActionTarget(Z8-1500)
998	FORMAT("+ ",2I6,1X$)
	GOTO 200

1600	ISEC=-1					'U - DISPLAY REFERENCE SECTOR
	CALL SECTOR(ReferenceMap(1))
	GOTO 200

1700	CONTINUE	' SHOULDN"T HAPPEN
1800	CONTINUE
	STOP
C 
C P: PRINT OUT NEW SECTOR
C
1900	ISEC=-1
	CALL LIB$SET_CURSOR(2,40)
	CALL STROUT(" New Sector:",12)
	JECTOR=ICityProduction(GETCHX())
	IF (JECTOR.LT.0.OR.JECTOR.GT.9) GOTO 1900
	CALL SECTOR(PlayerMap(1))
	ISEC=-1
	Z6=0
	GOTO 100
C 
C R: PRINT OUT THE ROUND NUMBER
C
C2000	CALL LIB$SET_CURSOR(2,50)
C	CALL STROUT(" Round #",12)
C	CALL DECPRT(MDATE)
C	CALL EOL
C	GOTO 200
C 
C I: DIRECTIONAL STASIS
C
2100	AB=ReferenceMap(Z6)
	IF ((AB.LT."A").OR.(AB.GT."T")) GOTO 4500
	E=GETCHX()
	DO 2200 I=1,8
	J=I
2200	IF (COMM(I).EQ.E) GOTO 2300
	GOTO 4500
2300	IF (AB.NE."O") GOTO 2400
	FIPATH(CITFND(Z6))=J+6100
	GOTO 200
2400	H2=30
	CALL FIND(AB,Z6,MOVFLG,H2)
	MYCODE(MOVFLG)=J+6100
	GOTO 200
C 
C M: SAY WE WANT TO MOVE TO A LOCATION
C
2500	AB=ReferenceMap(Z6)
	IF ((AB.LT."A").OR.(AB.GT."T")) GOTO 4500
	IF (AB.NE."O") GOTO 2600
	WHTFLG="CI"
	MOVFLG=CITFND(Z6)
	GOTO 200
2600	H2=30
	CALL FIND(AB,Z6,MOVFLG,H2)
	WHTFLG="UN"
	GOTO 200
C 
C K: WAKE UP ANYTHING AND EVERYTHING
C
2700	AB=ReferenceMap(Z6)
	IF ((AB.LT."A").OR.(AB.GT."T")) GOTO 4500
	IF (AB.NE."O") GOTO 2800
	FIPATH(CITFND(Z6))=0		'IF CITY, KILL FLIGHT PATH
	DO 2750 I=501,1500		'WAKE ANY FIGHTERS OR SHIPS
	IF (UnitLocation(I).EQ.Z6) MYCODE(I)=0
2750	CONTINUE
	GOTO 200
2800	H2=30				'NOT A CITY, FIND THE UNIT
	CALL FIND(AB,Z6,MOVFLG,H2)
	MYCODE(MOVFLG)=0		'ZERO ANY FUNCTION CODE
	IF (AB.NE."T") GOTO 2817	'IF TRANSPORT, WAKE ARMIES ABOARD
	DO 2816 J=1,500
2816	IF (UnitLocation(J).EQ.Z6) MYCODE(J)=0
	GOTO 200
2817	IF (AB.NE."C") GOTO 200		'IF CARRIER, WAKE FIGHTERS ABOARD
	DO 2818 J=501,700
2818	IF (UnitLocation(J).EQ.Z6) MYCODE(J)=0
	GOTO 200
C 
C N: GO HERE
C
2900	IF (WHTFLG.NE."CI") GOTO 3000
	FIPATH(MOVFLG)=Z6
	GOTO 200
3000	IF (WHTFLG.NE."UN") GOTO 4500
	MYCODE(MOVFLG)=Z6
	GOTO 200
C 
C S: GOTO SLEEP
C
3100	AB=ReferenceMap(Z6)
	IF ((AB.LT."A").OR.(AB.GT."T")) GOTO 4500
	IF (AB.EQ."O") GOTO 4500
	H2=30
	CALL FIND(AB,Z6,MOVFLG,H2)
	MYCODE(MOVFLG)=50
	GOTO 200
C 
C ?: REQUEST INFO
C
3200	AB=ReferenceMap(Z6)
	IF (AB.EQ."O") GOTO 3800
	IF ((AB.EQ."X").AND.(PASS)) GOTO 3800
	IF ((AB.GE."A").AND.(AB.LE."T")) GOTO 3250
	IF ((AB.GE."a").AND.(AB.LE."t").AND.(PASS)) GOTO 3250
	GOTO 4500

3250	H2=30
	CALL FIND(AB,Z6,MOVFLG,H2)
	IF (MOVFLG.LE.1500) THEN
	   DO 3300 I=1,8
3300	   IF (AB.EQ. PHAZE(I)) RELNUM=MOVFLG-CRALOC(PH(I))
	   CALL HEAD(AB,RELNUM,MOVFLG,Z6,H2)	'DISPLAY STANDARD HEADER
	 ELSE
	   CALL LIB$SET_CURSOR(1,1)
	   TYPE 989,MOVFLG,UnitAction(MOVFLG-1500),UnitActionTarget(MOVFLG-1500),H2
989	   FORMAT("+ UNIT=",I5,"  FUNCTION=",I5,"  SUB FUNC=",I5,
	1  " HITS=",I2,$)
	   CALL LIB$ERASE_LINE
	ENDIF
	IF ((AB.EQ."A").OR.(AB.EQ."F").OR.(AB.EQ."a").OR.(AB.EQ."f")) GOTO 200
C	CALL LIB$SET_CURSOR(2,1)			'DO HITS FOR SHIPS
C	CALL STROUT(" Hits left:",10)
C	CALL DECPRT(H2)
C	CALL LIB$ERASE_LINE
	N=0
	BASE=0
	IF (MOVFLG.GT.1500) BASE=1500
	IF ((AB.NE."T").AND.(AB.NE."t")) GOTO 3500
	DO 3400 I=1,500				'COUNT ARMIES
3400	IF (UnitLocation(I+BASE).EQ.Z6) N=N+1
	IF (N.EQ.0) GOTO 3700
	IF (MODE.EQ.1) CALL LIB$SET_CURSOR(3,1)
	CALL DECPRT(N)
	CALL STROUT(" armies aboard.",1)
	GOTO 200
3500	IF ((AB.NE."C").AND.(AB.NE."c")) GOTO 200
	DO 3600 I=1,200				'COUNT FIGHTERS
3600	IF (UnitLocation(I+500+BASE).EQ.Z6) N=N+1
	IF (N.EQ.0) GOTO 3700
	IF (MODE.EQ.1) CALL LIB$SET_CURSOR(3,1)
	CALL DECPRT(N)
	CALL STROUT(" fighters aboard.",1)
	GOTO 200
3700	IF (MODE.EQ.1) CALL LIB$SET_CURSOR(3,1)		'NOTHING THERE
	CALL STROUT("Nothing aboard.",1)
	GOTO 200
C
C	DISPLAY CITIES INFO
C
3800	J=CITFND(Z6)				'FIND CITY
	BASE=0
	IF (CityOwner(J).EQ.2) BASE=1500
	N=0
	DO 3900 I=BASE+501,BASE+700		'COUNT FIGHTERS
3900	IF (UnitLocation(I).EQ.Z6) N=N+1
	CALL LIB$SET_CURSOR(2,1)
	CALL STROUT(" Fighters landed:",10)
	CALL DECPRT(N)
	N=0	
	DO 4000 I=BASE+701,BASE+1500		'COUNT SHIPS
4000	IF (UnitLocation(I).EQ.Z6) N=N+1
	CALL STROUT("  Ships docked:",10)
	CALL DECPRT(N)
	CALL LIB$ERASE_LINE
4150	CALL LIB$SET_CURSOR(1,1)		'EXPLAIN PRODUCTION
	CALL STROUT(" City at location:",10) 
	CALL DECPRT(Z6)
	CALL STROUT("  Producing:",10)
	DO 4100 I=1,8
4100	IF (CityProduction(J).EQ.PH(I)) TYPE 997,PHAZE(I)
997	FORMAT("+",A1,$)
	CALL STROUT("  Completion:",10) 
	CALL DECPRT(FOUND(J))
	CALL STROUT("  Fpath:",10)
	IF (FIPATH(J).LT.100) CALL STROUT("sit",0)
	IF ((FIPATH(J).GT.100).AND.(FIPATH(J).LT.6000))
	1	CALL DECPRT(FIPATH(J))
	IF (FIPATH(J).GT.6100) TYPE 997, COMM(FIPATH(J)-6100)
	CALL LIB$ERASE_LINE
	GOTO 200
C 
C Y: ENTER NEW CITY PRODUCTION
C
4200	AB=ReferenceMap(Z6)
	IF (AB.NE."O") GOTO 4500
	J=CITFND(Z6)
	CALL LIB$SET_CURSOR(2,40)
	CALL STROUT(" New Production:",13)
	CALL PHASIN(J,E)
	TYPE 999,E
	GOTO 4150
C 
C R: SET ARMY TO MOVE AT RANDOM
C
4300	AB=ReferenceMap(Z6)
	IF (AB.NE."A") GOTO 4500
	H2=30
	CALL FIND(AB,Z6,MOVFLG,H2)
	MYCODE(MOVFLG)=100
	GOTO 200
C 
C H: GET HELP
C
4400	CALL HELP
	E=GETCHX()
	ISEC=-1
	CALL SECTOR(PlayerMap(1))
	ISEC=-1
	GOTO 100
C 
4500	CALL HUH
	GOTO 200
	END